---
layout: post
title: "Qt + FFmpeg 实现音视频播放器"
date:   2020-01-22
tags: [解码,音视频,FFmpeg,播放器,MP4]
comments: true
author: admin
---
# Qt + FFmpeg 实现音视频播放器

## 项目简介

本项目是一个基于 Qt 和 FFmpeg 开发的音视频播放器。该播放器支持多种功能，包括硬解码和软解码、音视频同步、播放控制（如上一首、下一首、暂停、停止等）、音量调节、快进回退、截图等。此外，播放器还支持 Windows、MacOs 和 Linux 平台。

## 主要功能

1. **硬解码和软解码**：支持 qsv/dxva2/d3d11va 硬解码 H265/H264 码流的 MP4 文件，同时也支持 CPU 软解视频文件。
2. **音视频同步**：确保音视频播放的同步性。
3. **播放控制**：支持上一首、下一首、暂停、停止、拍照截图等功能。
4. **音量调节**：可以调节音量大小，支持静音功能。
5. **快进回退**：通过滑动条实现视频的快进和回退。
6. **多平台支持**：支持 Windows、MacOs 和 Linux 平台。

## 实现方法

本项目使用 QOpenGLWidget 控件和 FFmpeg 库进行音视频解码。参考了 ffplay 播放器的实现思路，使用了两个线程：主线程用于界面控制和显示刷新，第二个线程用于视频流解码和音频流解码。FFmpeg 库读取 MP4 文件后，解码为 yuv420p/nv12 数据，然后使用 OpenGL 进行渲染。

## 代码实现

代码实现部分较为复杂，主要涉及视频文件的读取、解码、渲染等过程。具体代码实现细节请参考项目源码。

## 效果展示

- **硬解码**：硬解码 4k h265 编码的 MP4 文件时，CPU 使用率约为 4%，GPU 使用率约为 40%。
- **软解码**：软解码 4k 视频时，CPU 使用率约为 20%，GPU 使用率约为 28%。

## 使用说明

1. 下载项目源码。
2. 根据平台要求配置 Qt 和 FFmpeg 环境。
3. 编译并运行项目。
4. 打开 MP4 文件进行播放。

## 注意事项

- 确保系统中已安装 FFmpeg 库。
- 根据不同平台配置相应的硬解码环境。

## 贡献

欢迎开发者贡献代码，提出改进建议。

## 许可证

本项目遵循 CC 4.0 BY-SA 版权协议。

## 下载链接

[QtFFmpeg实现音视频播放器](https://pan.quark.cn/s/0c449a432cb5)