---
layout: post
title: "V4-006 基础例程 + FreeRTOS + DMA + USART1 + 消息队列 + MODBUS 双向通信"
date:   2020-03-08
tags: [MSG,MODBUS,任务,DI,队列]
comments: true
author: admin
---
# V4-006 基础例程 + FreeRTOS + DMA + USART1 + 消息队列 + MODBUS 双向通信

## 资源文件描述

本资源文件 `V4-006_基础例程+FreeRTOS+DMA+USART1+消息队列+MODBUS双向通信.zip` 提供了一个基于 FreeRTOS 的嵌入式系统例程，涵盖了多个任务、DMA、USART1、消息队列以及 MODBUS 双向通信的实现。以下是该例程的具体功能描述：

### 任务列表

1. **任务1**：控制闪烁3个指示灯。
2. **任务2**：控制闪烁2个指示灯。
3. **任务3**：采集2路DI（数字输入），并将采集到的数据通过消息队列发送给 MODBUS 任务。
4. **任务4**：采集2路DI（数字输入），并将采集到的数据通过消息队列发送给 MODBUS 任务。
5. **任务5**：每隔1秒读取一次 SD2405 时钟芯片的时间，并将时间数据通过消息队列发送给 MODBUS 任务。
6. **任务6**（MODBUS 任务）：接收上位机的请求命令，并将任务3、任务4采集的DI数据以及任务5读取的 SD2405 时钟芯片的时间发送给上位机。

### 消息队列规划

消息队列用于任务之间的通信，具体规划如下：

- **MSG[0] = 1**：表示接收到上位机的请求命令。
- **MSG[0] = 2**：表示接收到任务5的 SD2405 时钟芯片的时间。
  - **MSG[1]**：年
  - **MSG[2]**：月
  - **MSG[3]**：日
  - **MSG[4]**：时
  - **MSG[5]**：分
  - **MSG[6]**：秒
  - **MSG[7]**：星期
- **MSG[0] = 3**：表示接收到任务3采集的2路DI。
  - **MSG[1]**：第1路DI
  - **MSG[2]**：第2路DI
- **MSG[0] = 4**：表示接收到任务4采集的2路DI。
  - **MSG[1]**：第1路DI
  - **MSG[2]**：第2路DI

### 串口中断服务程序

串口中断服务程序负责接收一帧完整的报文，并将接收到的报文通过消息队列发送给 MODBUS 任务。

## 使用说明

1. **解压文件**：下载并解压 `V4-006_基础例程+FreeRTOS+DMA+USART1+消息队列+MODBUS双向通信.zip` 文件。
2. **导入工程**：将解压后的工程文件导入到你的开发环境中（如 Keil、IAR 等）。
3. **编译与下载**：编译工程并将其下载到目标硬件中。
4. **调试与测试**：根据任务描述，调试各个任务的功能，并测试 MODBUS 双向通信的实现。

## 注意事项

- 请确保硬件平台支持 FreeRTOS 和 DMA 功能。
- 在调试过程中，注意观察各个任务的执行情况，确保消息队列的正确使用。
- 如有任何问题，请参考相关文档或联系开发者获取支持。

## 贡献与反馈

如果你在使用过程中发现任何问题或有改进建议，欢迎提交 Issue 或 Pull Request。我们期待你的反馈，以帮助我们不断完善这个例程。

## 下载链接

[V4-006基础例程FreeRTOSDMAUSART1消息队列MODBUS双向通信](https://pan.quark.cn/s/49d82df3d762)