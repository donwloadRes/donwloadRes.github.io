---
layout: post
title: "STM32F103 使用 DAC 播放 WAV"
date:   2023-05-27
tags: [WAV,音频,播放,STM32F103,DAC]
comments: true
author: admin
---
# STM32F103 使用 DAC 播放 WAV

本仓库提供了一套完整的示例工程，用于演示如何利用STM32F103系列微控制器，集成TIM（定时器）、DMA（直接存储器访问）、DAC（数字模拟转换器）、FATFS（文件系统）以及SPI接口连接的FLASH（这里特指W25Q64为例），来实现从闪存中读取WAV格式的音频文件并进行播放的功能。该方案非常适合那些需要在嵌入式项目中添加音频播放功能的应用场景。

## 工程概述

- **开发环境**: STM32CubeMX初始化代码生成 + HAL库
- **目标芯片**: STM32F103系列（适用于具有足够Flash和RAM资源的型号）
- **核心功能**:
    - 使用TIM配置DMA传输，确保音频数据连续稳定地供给DAC。
    - 利用FATFS文件系统读取位于SPI FLASH上的WAV文件。
    - 实现WAV音频数据的解码播放，支持基础的WAV格式（例如：单声道或立体声，标准采样率等）。
    - 全部基于STM32CubeMX配置，代码结构清晰，便于理解和二次开发。

## 技术要点

1. **STM32CUBEMX配置**：详细说明了如何通过STM32CUBEMX配置TIM、DMA、DAC、SPI和FATFS等外设，以及相关的中断和DMA通道设置。
2. **FATFS应用**：展示如何初始化FATFS并在STM32上操作文件，包括打开、读取WAV文件的数据部分。
3. **WAV文件解析**：简要介绍了如何解析WAV头部信息，以确定音频的采样率、位深和声道数。
4. **DMA与音频流处理**：解释如何设置DMA来自动传输音频数据至DAC，实现无CPU干预的音频播放。

## 快速入门

1. **下载工程**：首先下载本仓库到本地。
2. **IDE准备**：确保你的开发环境已经安装了STM32CubeIDE或其他兼容STM32 HAL库的IDE。
3. **配置硬件**：你需要一块STM32F103开发板，以及外部的SPI FLASH（如W25Q64）烧录好WAV文件。
4. **导入工程**：在STM32CubeIDE中导入下载好的工程文件。
5. **编译与调试**：根据所使用的开发板配置正确的硬件连接，然后编译并下载程序到STM32。
6. **测试**：运行程序后，你应该能够通过连接到STM32的音频输出听到WAV文件的播放效果。

## 注意事项

- 请确保你的STM32F103型号有足够资源运行此应用。
- 调试过程中注意检查SPI FLASH的地址映射是否正确配置。
- WAV文件的规格需与工程中的处理逻辑相匹配，避免播放异常。
- 本工程旨在教学和示范目的，实际应用时可能需要根据具体需求进行调整。

通过本仓库提供的资源，开发者可以快速掌握在STM32平台上实现音频播放的技术细节，为自己的项目增添声音元素。

## 下载链接

[STM32F103使用DAC播放WAV](https://pan.quark.cn/s/6abaf367829a)