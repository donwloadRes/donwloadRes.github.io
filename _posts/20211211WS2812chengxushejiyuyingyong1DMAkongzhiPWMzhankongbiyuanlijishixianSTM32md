---
layout: post
title: "WS2812 程序设计与应用（1）：DMA 控制 PWM 占空比原理及实现（STM32）"
date:   2020-03-05
tags: [WS2812,DMA,PWM,STM32,占空比]
comments: true
author: admin
---
# WS2812 程序设计与应用（1）：DMA 控制 PWM 占空比原理及实现（STM32）

## 简介
本资源文件详细介绍了如何使用STM32微控制器通过DMA（直接内存访问）和PWM（脉宽调制）技术来控制WS2812 LED灯带的占空比。WS2812是一种集成了控制芯片和RGB LED的智能灯珠，通过单总线协议可以实现全彩效果。

## 内容概述
1. **WS2812 简介**：
   - WS2812内部集成了处理芯片和三颗不同颜色的LED灯（红、绿、蓝），通过单总线协议分别控制三个灯的亮度强弱，达到全彩效果。
   - 每个灯需要24 bits（3 bytes）的数据。

2. **WS2812 驱动的几种方式**：
   - 使用NOP指令延时，直接翻转IO口产生时序。
   - 使用SPI数据传输产生时序。
   - 使用DMA+Timer产生时序。
   - 使用DMA+Timer+PWM产生时序（本文讨论的实现方案）。

3. **DMA+PWM+TIM 驱动 WS2812**：
   - 定时器TIM用以产生一个固定周期的PWM，DMA用以改变PWM的占空比。
   - DMA通过不断的搬运数据到定时器调节占空比的CCR寄存器，实现WS2812时序的产生。

4. **STM32CubeMx 配置**：
   - 基础配置：包括系统时钟、定时器、PWM和DMA的配置。
   - 硬件连接：将WS2812的信号线连接到STM32的PA8引脚。

5. **程序设计**：
   - 初始化灯珠的数组。
   - 开启DMA传输。
   - 传输完毕后关闭DMA传输。

6. **程序验证**：
   - 在main函数中调用测试函数，验证程序运行正常。

## 附件
- MDK5示例工程
- WS2812中英文数据手册

## 使用说明
1. 下载并解压资源文件。
2. 使用MDK5打开示例工程。
3. 根据硬件连接图连接WS2812灯带。
4. 编译并下载程序到STM32开发板。
5. 观察WS2812灯带的效果，验证程序功能。

## 注意事项
- 确保WS2812的供电充足，并与STM32共地。
- 在配置DMA和PWM时，注意参数的设置，以确保时序的准确性。

通过本资源文件，您将能够掌握如何使用STM32通过DMA和PWM技术来驱动WS2812 LED灯带，实现丰富多彩的灯光效果。

## 下载链接

[WS2812程序设计与应用1DMA控制PWM占空比原理及实现STM32](https://pan.quark.cn/s/3a7d9b3e9da7)